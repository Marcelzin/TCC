<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Comércio</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-5">
    <h2>Cadastro de Comércio</h2>
    <form id="cadastroForm">
        <div class="form-group">
            <label for="nome">Nome do Comércio:</label>
            <input type="text" class="form-control" id="nome" maxlength="35" placeholder="Digite o nome do comércio">
        </div>
        <div class="form-group">
            <label for="cpfCnpj">CPF/CNPJ:</label>
            <input type="text" class="form-control" id="cpfCnpj" placeholder="Digite o CPF ou CNPJ">
        </div>
        <button type="submit" class="btn btn-primary">Cadastrar</button>
    </form>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Seletor para o campo de CPF/CNPJ
        const cpfCnpjInput = document.getElementById("cpfCnpj");
    
        // Aplicar a máscara usando o Inputmask
        $(cpfCnpjInput).inputmask({
            mask: ['999.999.999-99', '99.999.999/9999-99'],
            keepStatic: true,
            clearIncomplete: true,
        });
    });
</script>
    
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("cadastroForm");

        form.addEventListener("submit", function (event) {
            event.preventDefault();

            const nome = document.getElementById("nome").value.trim();
            const cpfCnpj = document.getElementById("cpfCnpj").value.trim();

            // Validação simples para verificar se os campos estão preenchidos
            if (!nome || !cpfCnpj) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erro',
                    text: 'Por favor, preencha todos os campos.',
                    timer: 3000
                });
                return;
            }

            // Dados do formulário
            const formData = new FormData();
            formData.append('nome', nome);
            formData.append('cpf_cnpj', cpfCnpj);

            // Requisição AJAX
            fetch('/TCC/QUERYS/cadastro_comercio.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    Swal.fire({
                        icon: 'success',
                        title: 'Cadastro realizado com sucesso!',
                        text: data.message,
                        timer: 3000
                    });

                    // Redirecionar para cadastro_prop.php após 3 segundos
                    setTimeout(function() {
                        window.location.href = '/TCC/PAGES/cadastro_prop.html';
                    }, 500);
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro',
                        text: data.message,
                        timer: 3000
                    });
                }
            })

            .catch(error => {
                console.error(error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erro na requisição AJAX',
                    text: 'Ocorreu um erro ao enviar a solicitação. Verifique a conexão ou tente novamente mais tarde.'
                });
            });
        });
    });
</script>
</body>
</html>
